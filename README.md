# WakeyWakey

A tiny macOS menu bar app that keeps your Mac awake by simulating subtle user activity only when you’ve been idle.

- Menu bar only (no Dock icon)
- Enable/Disable toggle with clear icon state
- Generates small, random mouse movements only after 42 seconds of inactivity, then at randomized 42–79 second intervals
- Prevents system idle sleep while enabled


## Requirements
- macOS 15.0 or later
- Xcode with macOS 15 SDK
- Homebrew (for XcodeGen)
- Accessibility permission (System Settings > Privacy & Security > Accessibility)


## How it works (current behavior)
- When you click Enable:
  - The app sets an IOPM idle-sleep prevention assertion (so the system won’t sleep)
  - It waits until you’ve been idle for at least 42 seconds
  - Then it performs a single, small cursor move at random intervals between 42–79 seconds
    - Each move shifts the cursor by independent random dx and dy between 11–23 pixels in random directions
    - Movements are clamped within the current screen under the cursor and anchored to the main display’s coordinate origin to avoid snapping; works across multiple monitors (including DisplayLink)
- When you click Disable:
  - Sleep prevention and activity generation stop immediately
- Menu bar icon:
  - Disabled: SF Symbol cup.and.saucer (empty cup)
  - Enabled: SF Symbol cup.and.saucer.fill (full cup)


## Project structure
```
WakeyWakey/
├── WakeyWakey.xcodeproj              # generated by XcodeGen
├── project.yml                       # XcodeGen configuration
├── PROMPT.md                         # design and implementation notes
├── README.md                         # this file
├── scripts/
│   ├── build_debug.sh                # Debug build (arm64)
│   ├── build_release.sh              # Release build (arm64)
│   ├── generate_appicon.sh           # Create AppIcon assets from source PNG
│   ├── generate_project.sh           # Run xcodegen generate
│   ├── install.sh                    # Copy built app to /Applications
│   ├── kill.sh                       # Kill running app
│   └── run.sh                        # Open app from /Applications
├── Icon_WakeyWakey.icon/
│   ├── Assets/image.png              # source image for app icon
│   └── icon.json
└── WakeyWakey/
    ├── AppDelegate.swift             # app logic (menu bar, timers, jiggle)
    ├── main.swift                    # required entry point for menu bar app
    └── Resources/Info.plist          # LSUIElement=true (no Dock icon)
```


## Setup
1) Install XcodeGen (one time)
```
brew install xcodegen
```

2) Generate the Xcode project
```
./scripts/generate_project.sh
```

3) (Optional) Regenerate AppIcon from the provided PNG if you change it
```
./scripts/generate_appicon.sh
```


## Build, install, and run (Debug)
```
./scripts/build_debug.sh
./scripts/install.sh
./scripts/run.sh
```
- First launch may prompt for Accessibility permission. If the permission dialog does not appear, go to:
  System Settings > Privacy & Security > Accessibility, add WakeyWakey, enable it, then relaunch the app.

- To stop the app:
```
./scripts/kill.sh
```


## Release build and distribution
Create a Release build:
```
./scripts/build_release.sh
```
The resulting app is here:
```
build/Build/Products/Release/WakeyWakey.app
```
Copy to Applications on this Mac:
```
cp -R build/Build/Products/Release/WakeyWakey.app /Applications/
```
Create a distributable zip (already used in our workflow):
```
mkdir -p dist
# Using ditto preserves macOS metadata and resource forks for apps
ditto -c -k --sequesterRsrc --keepParent build/Build/Products/Release/WakeyWakey.app dist/WakeyWakey-Release.zip
```
Install on another Mac:
- Transfer the zip (AirDrop or scp)
- Unzip with Finder or:
```
ditto -x -k ~/Downloads/WakeyWakey-Release.zip ~/Downloads/
```
- Move to Applications:
```
mv ~/Downloads/WakeyWakey.app /Applications/
```
- First run on another Mac may require Control-click > Open (Gatekeeper)
- Grant Accessibility permissions, then relaunch


## Configuration
- Bundle ID: `com.brndnsvr.WakeyWakey` (set in Info.plist and project.yml)
- Deployment target: macOS 15.0 (project.yml)
- Architecture: arm64 only for Debug and Release builds (project.yml and scripts)
- Code signing: Automatic; the project is configured with your Team ID
  - To change team or signing style, edit `project.yml` and regenerate with `./scripts/generate_project.sh`


## Permissions
WakeyWakey needs Accessibility permission to post input events (mouse moves). If permission is missing, the app displays an alert. You can grant it via:
- System Settings > Privacy & Security > Accessibility
- Add WakeyWakey and toggle it on, then restart the app


## Roadmap
Planned/possible enhancements once the core is stable:
- Zen Mode: “invisible” activity (e.g., 0-pixel mouse move)
- Preferences (UserDefaults) for interval tuning and modes
- Status in menu (idle time, action counter)
- Configurable strategies (mouse only, keyboard nudge, mixed)
- Launch at login option
- About dialog


## Troubleshooting
- No menu bar icon appears
  - Ensure you’re running the app from /Applications and that `LSUIElement` is true (it is set in Info.plist)
- Menu not responding to clicks
  - Quit and relaunch; the status item is configured with target/action as required
- App doesn’t seem to “jiggle”
  - Jiggle only happens after 42 seconds of inactivity; move away from the mouse/keyboard for ~45 seconds to test
- Cannot control the mouse
  - Ensure Accessibility permission is granted and the app has been relaunched after granting
- Pointer jumps to the primary display during jiggle on multi-monitor setups (including DisplayLink)
  - Movements are clamped to the current screen and coordinates are anchored to the main display to avoid cross-display snapping. If issues persist, restart DisplayLink Manager, re-plug displays, and re-grant Accessibility permission for WakeyWakey, then relaunch. (Fix implemented in `AppDelegate.performActivity()`.)
- Gatekeeper warning on another Mac
  - Control-click the app and choose Open; confirm the dialog


## Notes
- Uses AppKit (not SwiftUI), with a required `main.swift` for proper menu bar initialization
- Sets `NSApp.setActivationPolicy(.accessory)` in AppDelegate.init()
- Uses IOKit’s IOPM assertions to prevent system idle sleep
- Uses ApplicationServices to post CGEvents for subtle mouse movement
- The app icon in /Applications is set from the provided icon asset; the menu bar icon uses SF Symbols (cup) templates for light/dark mode


## License
TBD
